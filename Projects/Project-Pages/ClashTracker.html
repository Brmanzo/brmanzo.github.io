<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Clash Tracker</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!--  Google Font  -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

	<!--  Core-in-file CSS (swap to external file later if you like)  -->
	<link rel="stylesheet" href="/styles.css">
</head>

<body>
	<!-- =======================================
			 HEADER
	======================================== -->
	<header>
		<div class="logo">Bradley R Manzo</div>
		<nav>
			<a href="/index.html">About Me</a>
			<a href="/Projects/projects.html">Projects</a>
			<a href="/Work-Experience/work-experience.html">Work Experience</a>
			<a href="/assets/Bradley_Manzo_resume.pdf">Resume</a>
			<a href="#contact">Contact</a>
		</nav>
	</header>

	<!-- =======================================
			 MAIN CONTENT
	======================================== -->
	<main>

		<!-- --------  About Project -------- -->
		<section id="about" class="hero">
		<h1>Clash Tracker Screenshot Analyzer</h1>
		<img src="/Projects/Project-Assets/clashStarTracker.png" alt="Clash Tracker Logo" width="200">
		<p>
			This program analyzes game screenshots by converting to HSL, (Hue, Saturation, and Lightness) and detects changes in the minimum, 
			maximum, and average lightness of the image to locate features. This led me to develop powerful functions like <em>measure_image()</em>, 
			which works similarly to .measure in SPICE. Given a specific threshold for the averaged stat of an image's row or column, 
			it will return the first and either the next or last occurrence of the stat either rising or falling through this threshold. 
			In this way its similar to measuring propagation delay in circuit analysis by timing when the voltage rises and falls through VDD/2! 
			This threshold can either be absolute (from 0), or relative (how much it changed from the last measurement) Later I also added the 
			option for a secondary condition, as well as greater functionality to track whenever two stats diverge and converge again within a given threshold. 
		</p>
		<img src="/Projects/Project-Pages/Project-Pages-Assets/clash_tracker_HSL.png"  alt="Graph of min, max and average lightness of screenshot" width="800">			 
		<h3>Graph of Min, Max and Average Lightness of Screenshot</h3><br>
		<p>
			When I realized that the proper threshold depends on the image itself and is not a fixed constant, I developed <em>sample_image()</em> to perform 
			adaptive thresholding for any requested statistic. This function samples the image by row or column, sorts from greatest to least, and 
			returns the first repeating value as a threshold. This way you can filter out the regular noise, from the sharp jumps in minimum, or 
			change in average. You can also provide it with a global maximum to filter out, and provide an epsilon value for how similar you want 
			the repeating values to be.
		</p>
		<img src="/Projects/Project-Pages/Project-Pages-Assets/adaptiveThresholding.png"  alt="local maximum filtering" width="800">
		<h3>Filtering Global Maximum to Detect Local Maximum</h3><br>
		<p>
			Once the data has been located within the image, the image is preprocessed by analyzing the darkness of the image, grouping the dark font 
			outline with the background of the image, and then inverting the colors so the font color is black on a white background. Noise is further 
			reduced by removing black shapes in contact with the border, and shapes larger than a constant threshold, however I found any further processing 
			like convolutional filtering to reduce clarity and the results of optical character recognition.
		</p>
		<div class="img-row">
				<img src="/Projects/Project-Pages/Project-Pages-Assets/playerRaw.png"        alt="Raw Text" width = 300>
				<img src="/Projects/Project-Pages/Project-Pages-Assets/playerPreProcess.png"  alt="Preprocessed Text" width = 300>
		</div>  
		<h3>Raw Text -> Preprocessed Text </h3><br>
		<p>
			At first when OCR with pytesseract, I was getting mixed results and decided to train my own model, however it was very inaccurate even after 
			gathering, boxing and processing over 200 player names. I found that further focusing my cropping of features and smart use of page segmentation 
			modes greatly improved my accuracy than a custom model could. Player rank is especially important since it is a great indicator of the difficulty 
			of an attack, so these are isolated from the player names and processed using PSM 10 for single characters, and whitelisted so the response is only 
			ever integers or integer-like characters. When these occur, I translate them based on past experience via lookup table. If no integer is located, 
			I check to see if the player was seen before, then assign the player the previously acknowledged rank. Otherwise I iterate through previously 
			seen players to assign it the next available entry in descending order.
		</p>
		<img src="/Projects/Project-Pages/Project-Pages-Assets/playerBoxed.png" alt="Boxed Player Name" width = 300>
		<h3>Creating Dataset using JTess Box Editor</h3><br>
		<p>
			Player names are processed using PSM 7 for a single line of characters, and autocorrect to a library of predefined character names for your 
			team using fuzzy matching at a fixed confidence. Enemy names are secondary in importance, compared to enemy rank, so the first OCR result 
			is simply added to a set, and further OCR results are fuzzy matched to their initial readings. Scores are processed by measuring the section
			of the screenshot with stars. If the max lightness is 1, that means black is present, and only new stars have a black outline. Old stars
			have a noisy average lightness, so if all values are outside the noise threshold we consider it an old star. Otherwise the star is missing.
		</p>
		<img src="/Projects/Project-Pages/Project-Pages-Assets/StarProcessing.png" alt="score processing" width = 800>
		<h3>Score Processing</h3>
		<p>
			I've added support for names that alias with each other via a provided json file called multi_accounts.json. Inside is a dictionary 
			where the key is the OCR returned string, and the value is a list of all aliasing players in descending rank. This ordering is consistent 
			with war strength, but may drift over time. This also changes depending on the aliased players participation in each war, so manual 
			adjustment can be made on a case by case basis.
		</p>
		<img src="/Projects/Project-Pages/Project-Pages-Assets/clashTrackerUI.png" alt="Program GUI" width = 800>
		<h3>Program GUI</h3><br>
		<p>
			Finally, I created a gui in order to gather the input files and images, while also exposing the internal constants to the user within settigns.
			This mainly includes the adaptive thresholding values for how similar the repeating values must be and how much to scale the result by, but also
			includes preprocessing constants, and tolerances for the new fallback mechanism. This records past successful measurements as defaults in case
			a measurement is not found, or not within the tolerance of the previous measurement.
		</p>
		<img src="/Projects/Project-Pages/Project-Pages-Assets/advancedSettings.png" alt="Program GUI" width = 800>

		</section>

		<!-- --------  Github Repository -------- -->
		<section id="cv" class="container cv">
			<h2>View the project code</h2>
			<a class="btn" href="https://github.com/Brmanzo/clash_star_tracker" download>Github Repo</a>
		</section>

		<section id="contact" class="container contact">
			<div class="social-links">
				<a class="icon-link" href="mailto:bmanzo@ucsc.edu" target="_blank" rel="noopener"
					aria-label="Email">
					<svg width="50" viewBox="130 115 70 70" fill="currentColor"
							xmlns="http://www.w3.org/2000/svg">
						<path d="m 142.16799,129.5626 c -2.69149,-7e-5 -4.87341,2.20635 -4.87341,4.92813 v 28.05862 c 0,2.72178 2.18192,4.9282 4.87341,4.92813 h 49.84918 c 2.69149,8e-5 4.87342,-2.20635 4.87342,-4.92813 v -28.05862 c 0,-2.72178 -2.18193,-4.92821 -4.87342,-4.92813 z m -0.91186,2.67582 h 51.6919 l -20.61223,15.69423 c 0,0 -1.771,1.67149 -5.22397,1.67834 v 5e-4 c -0.003,0 -0.006,-5e-4 -0.01,-5e-4 -0.003,0 -0.006,5e-4 -0.009,5e-4 v -5e-4 c -3.45296,-0.007 -5.22397,-1.6135 -5.22397,-1.6135 z m 53.37151,1.66112 v 28.25062 l -18.9425,-14.07871 z m -54.91561,0.18338 18.943,14.17192 -18.943,14.0787 z m 20.58234,15.60101 c 3.45838,2.84893 6.79846,2.48687 6.79846,2.48687 0,0 3.34009,0.36206 6.79847,-2.48687 l 19.65476,14.71955 c 0,0 -0.33856,0.43769 -1.3374,0.43769 H 167.09283 141.9765 c -0.99885,0 -1.3369,-0.43769 -1.3369,-0.43769 z" stroke="currentColor"/>        
					</svg>
				</a>

				<a class="icon-link" href="https://github.com/Brmanzo" target="_blank" rel="noopener"
					aria-label="GitHub">
					<!-- GitHub icon -->
					<svg width="50" viewBox="0 0 70 70" fill="currentColor"
							xmlns="http://www.w3.org/2000/svg">
								<path d="M 34.131046,1.0583333 C 15.865513,1.0583572 1.0583548,15.871228 1.0583333,34.143795 c 0.022208,14.365167 9.3080407,27.07471 22.9831627,31.457112 0.37121,0 1.941066,-0.117824 1.820557,-2.120077 l -0.05131,-5.565545 v -0.07716 c -7.470108,1.288784 -10.247676,-2.14345 -10.690648,-3.084651 -0.443294,-0.941898 -2.04277,-4.40258 -3.676797,-5.442821 -1.6340337,-1.040241 -1.5225527,-1.281434 -1.6153947,-1.727256 -0.09285,-0.445811 3.3795697,-2.080714 6.8333257,3.176206 2.963846,4.511264 7.884742,3.026864 9.224193,2.514136 0.350899,-2.959595 2.088901,-4.479862 2.088901,-4.479862 -10.361208,-1.065583 -14.282918,-6.393444 -14.960757,-14.046245 -0.677839,-7.652857 3.313665,-11.252605 3.313665,-11.252605 -1.643322,-4.777775 0.359439,-8.733553 0.359439,-8.733553 0.29368,-0.07057 0.612408,-0.09827 0.949046,-0.09108 3.254179,0.072 8.175038,3.447534 8.175038,3.447534 2.956779,-0.838462 5.81802,-1.10658 8.30757,-1.095547 2.489546,-0.01103 5.350793,0.257085 8.307572,1.095547 0,0 4.920858,-3.375451 8.175036,-3.447534 0.336639,-0.0072 0.655369,0.02045 0.94905,0.09108 0,0 2.002752,3.955778 0.359433,8.733553 0,0 3.991508,3.599748 3.313665,11.252605 -0.677837,7.652801 -4.599552,12.980662 -14.960759,14.046253 0,0 2.163575,1.860941 2.163575,5.508491 v 3.612949 l -0.05131,5.565545 c 0,0 0.106468,2.634748 2.480273,1.998689 v 0 C 58.688815,61.191685 67.189394,48.632141 67.204167,34.143835 67.204143,15.871107 52.396739,1.0581665 34.131046,1.0583731 Z"  stroke="currentColor"/>
					</svg>
				</a>

				<a class="icon-link" href="https://www.linkedin.com/in/bradley-r-manzo/" target="_blank" rel="noopener"
					aria-label="LinkedIn">
					<!-- LinkedIn icon -->
					<svg width="50" viewBox="0 0 70 70" fill="currentColor"
							xmlns="http://www.w3.org/2000/svg">
						<path d="M 14.135365,1.0583333 A 13.077031,13.077031 0 0 0 1.0583333,14.135365 V 52.6773 A 13.077031,13.077031 0 0 0 14.135365,65.754331 h 38.55314 A 13.077031,13.077031 0 0 0 65.765536,52.6773 V 14.135365 A 13.077031,13.077031 0 0 0 52.688505,1.0583333 Z m 1.372948,8.9071228 a 5.530878,5.530878 0 0 1 5.530762,5.5312029 5.530878,5.530878 0 0 1 -5.530762,5.53077 5.530878,5.530878 0 0 1 -5.5312125,-5.53077 5.530878,5.530878 0 0 1 5.5312125,-5.5312029 z M 44.846049,24.380031 c 3.304199,0.0078 6.616489,1.153381 7.928489,2.83102 1.479151,1.891383 2.734929,4.619417 3.088671,7.744325 l 0.102616,20.253178 c 0.0018,0.38013 -0.306547,0.688291 -0.684673,0.688265 h -8.241255 c -0.378137,2.6e-5 -0.684685,-0.308127 -0.684685,-0.688265 V 39.916623 c 0,-1.377508 -3.64e-4,-6.548847 -3.344987,-6.914913 -3.344609,-0.366039 -4.521739,0.243164 -6.022315,1.865396 -0.832343,0.899838 -1.104041,3.052435 -1.181613,4.792309 v 2.528122 12.906307 c 0,0.379958 -0.306271,0.688039 -0.684233,0.688265 h -8.241697 c -0.378127,2.6e-5 -0.684684,-0.308133 -0.684684,-0.688265 V 25.784786 c 0,-0.380131 0.306557,-0.688292 0.684684,-0.688266 h 7.768517 c 0.377954,2.25e-4 0.680348,0.308326 0.684233,0.688266 l 0.03581,3.48434 c 0.772609,-1.004212 3.15773,-3.673959 6.249948,-4.495671 1.02523,-0.272438 2.125734,-0.396024 3.227139,-0.393424 z m -33.498696,0.773848 h 8.29055 a 0.6887242,0.68826479 0 0 1 0.688716,0.688266 v 29.309501 a 0.6887242,0.68826479 0 0 1 -0.688716,0.688265 h -8.29055 A 0.6887242,0.68826479 0 0 1 10.658645,55.151646 V 25.842145 a 0.6887242,0.68826479 0 0 1 0.688708,-0.688266 z"   stroke="currentColor"/>
					</svg>
				</a>
			</div>
		</section>
	</main>

	<!-- =======================================
			 FOOTER
	======================================== -->
	<footer>
		© <span id="year"></span> Your Name | Built with ❤ and HTML + CSS
	</footer>

	<!--  Simple runtime bits  -->
	<script>
		// Auto-update copyright year
		document.getElementById('year').textContent = new Date().getFullYear();
	</script>
</body>
</html>
